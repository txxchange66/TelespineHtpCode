/*
Last Updated: February 14, 2014 at 11:05:22 AM
Creative Slave - demo.creativeslave.com
*/
function WeeklyTimeline(c){App.console.log("WeeklyTimeline called",1);this.TIMELINE_ID="Weekly-timeline";var b="";this.init=function(){App.console.log("WeeklyTimeline init()",2);this.getTimeline()};this.setDaysSinceStart=function(){$("span.getDaysSinceStart").html(this.getDaysSinceStart())};this.getDaysSinceStart=function(){if(App.user.startDate){var d=App.user.startDate;var e=new Date();var f=daysBetween(d,e);return f+1}return 1};this.getCurrentWeek=function(){var e=this.getDaysSinceStart();var d=0;if(e<7){d=1}else{if(e<=14){d=2}else{if(e<=21){d=3}else{if(e<=28){d=4}else{if(e<=35){d=5}else{if(e<=42){d=6}else{if(e<=49){d=7}else{d=8}}}}}}}return d};this.getTimeline=function(d){this.buildNavigation();this.buildWeekDays();this.setDaysSinceStart()};this.buildNavigation=function(){App.console.log(" > buildNavigation called. Current Week: "+this.getCurrentWeek(),2);var o=this.getCurrentWeek();var h='<div class="hidden-lg hidden-md hidden-sm col-sm-12 col-xs-12 timeline-header">Your 8 Week Program</div><div class="clearfix"></div><div class="row week-routine"><table class="col-lg-12 col-sm-12 col-xs-12 col-xxs-12"><tr>';var e="</tr></table></div>";var d="";var j='<td width="7%" class="hidden-xs"><div><div class="smallstat box round dark-grey falign"><div class="text-center hidden-xs hidden-sm size12">Begin</div><div class="text-center hidden-lg hidden-md size12"><li class="fa fa-circle"></li></div></div></div></td>';var g=j.replace("Begin","Finish");var g=g.replace("falign","text-right");d+=j;for(var k=0;k<8;k++){var f=k+1;var n="past";var i="display:none;";var m=this.getCurrentWeek()==Math.round(f);if(this.getCurrentWeek()==Math.round(f)){n="present";i="visibility:hidden;"}else{n="future";i="visibility:hidden;"}if((f)<this.getCurrentWeek()){n="past";i=""}var l='<td width="10.5%"><div><div class="box week-status-btn status-'+n+'-btn" onClick="viewWeek(\''+(f)+'\');" title="Click to open Week '+(f)+' Activities"><div class="color-black hidden-xs hidden-sm text-center">Week</div><div class="value m-pad text-center">'+(k+1)+'</div><li class="fa fa-check hidden-xs hidden-sm week-complete" style="position:absolute; right:16px; top:10px;color:#eee;font-size:18px;'+i+'"></li></div></div></td>';d+=l}d+=g;$("#"+this.TIMELINE_ID).html(h+d+e)};this.buildWeekDays=function(){var l=this;var t=new Date();var j=new Date(t.setDate(t.getDate()-l.getDaysSinceStart()));App.console.log(" > buildWeekDays called",3);for(var n=0;n<8;n++){var o=n+1;var s='<div class="week-status week'+(o)+' week-tl" id="weekView"><div class="week-text">Week '+(o)+"</div>";App.console.log(" > > Week: "+(n+1),5);var r=s;var m="";var e=false;for(var u=0;u<7;u++){try{var q=((7*n)+(u+1));var j=new Date(j.setDate(j.getDate()+1));var v=j.toDateString();App.console.log(" > > > Day: "+(u+1)+" "+v,3);var p=(e)?"top":"bottom";var g=(e)?"":"-bottom";var k=(l.getDaysSinceStart()==q)?"today":"";var h=(l.getDaysSinceStart()==q)?" (Today)":"";if(q<=l.getDaysSinceStart()){var x='<div class="week-tl-box'+g+' hidden-xs" style="left:'+(13.5*u+2)+'%"><div class="week-tl-'+p+'-flag "><div class="week-tl-flag-text">Day&nbsp;'+q+'</div><i class="fa fa-calendar week-tl-'+p+'-flag-li"></i> </div><div class="week-tl-'+p+"-box hidden-xs "+k+'"><div style="padding:1px 4px;" onClick="showWeekActivites('+(o)+')"><b>'+v+" "+h+'</b></div><br><div class="todo" style="border-radius:8px; padding:4px;"><ul id="dayEvents_'+((7*n)+(u+1))+'">'+l.getActivities(u+1)+'</ul></div><div class="clearfix"></div></div></div>';m+=x}else{if(n+1>l.getCurrentWeek()){var x='<div class="futureTsActivities">Your future Telespine activities will be shown here.</div>';m+=x}}e=!e}catch(f){}}r=s+m+"</div>";var i='<div style="position:absolute; top:73px;width:40px;display:none;z-index:200" id="weekViewArrow"><img src="'+App.settings.baseImageURL+'top-white-arrow.png" width="30" height="49"></div><div style="position:absolute; top:96px;right:-8px; width:30px;display:none" id="weekViewActions"><li class="fa week-tl-close" onClick="viewWeek(currentWeek)">x</li></div><div style="position:absolute; top:126px;right:-8px; width:30px;display:none; " id="weekViewActions2"><li class="fa fa-info week-tl-close btn-setting text-center" onClick="App.showHelp(\'timeline\')" style="width:20px"></li></div>';$("#"+this.TIMELINE_ID).append(r+i)}};this.getActivities=function(d){return""};this.setActivities=function(g){var m=g.length;var e=0;for(a=0;a<m;a++){try{var f=a;var h=g[a];var k=(h.status=="complete")?"fa-check":"fa-angle-double-right";var n=h.type;var i="";if(h.kind.toLowerCase()=="video"){i="App.openMovie"}else{if(h.kind.toLowerCase()=="article"){i="App.openArticle"}else{i="App.showTip"}}var p=h.label;var o="";if(h.kind=="video"){o=' &nbsp;<i class="fa fa-play-circle" style="color:#3E70DA !important;padding-left:8px"></i>';p='Watch the "'+h.label+'" video.'}else{if(h.kind=="article"){o=' &nbsp;<i class="fa fa-file-text" style="color:#3E70DA !important;padding-left:8px"></i>';p='Read the "'+h.label+'" article.'}}if(n.toLowerCase()=="posture"){n='<span class="label label-important" title="Posture">p</span>'}else{if(n.toLowerCase()=="mobility"){n='<span class="label label-success" title="Mobility">m</span>'}else{if(n.toLowerCase()=="core strength"){n='<span class="label label-warning" title="Core Strength">c</span>'}else{if(n.toLowerCase()=="flexibility"){n='<span class="label label-info" title="Flexibility">f</span>'}}}}var j='<li class="bg-none li-activity"><span class="todo-actions"> <a href="#"> <i class="fa '+k+'" style="color:#0D3EA6 !important;"></i></a> </span><span class="desc li-activity"><a href="javascript:'+i+"("+f+');">'+p+" "+o+"</a></span></li>";if(!App.isMobile()){$("#dayEvents_"+h.day).append(j)}if(this.getDaysSinceStart()==h.day){e++;App.console.log("Setting Today's Activities: dailyActivities2",3);App.console.log(" > getDaysSinceStart: "+this.getDaysSinceStart(),3);App.console.log(" > dayNum: "+f,3);App.console.log(" > HTML: \n > "+j,5);$("#dailyActivities2").append(j)}var d=1;if(h.day<8){d=1}else{if(h.day<15){d=2}else{if(h.day<22){d=3}else{if(h.day<29){d=4}else{if(h.day<36){d=5}else{if(h.day<43){d=6}else{if(h.day<50){d=7}else{if(h.day<57){d=8}}}}}}}}if((h.day)<=this.getDaysSinceStart()){$("#dailyActivitiesWeek"+d).append('<h3 class="section day-section-'+h.day+' ">Day: '+h.day+" Activities</h3>"+j)}else{$("#dailyActivitiesWeek"+d).append('<h3 class="section">Day: '+h.day+" Activities</h3>You will see future activities here.")}}catch(l){App.console.log(l)}$(".getNumberOfItems").html(e);App.console.log(" > Adding Activity to: #dayEvents_"+h.day,3)}}}function daysBetween(g,f){var c=Math.abs(g.getTimezoneOffset()/60)-Math.abs(f.getTimezoneOffset()/60);f.addHours(c);var h=1000*60*60*24;var e=g.getTime();var d=f.getTime();var b=Math.abs(e-d);return Math.round(b/h)}Date.prototype.addHours=function(b){this.setHours(this.getHours()+b);return this};var currentWeek="";function viewWeek(d){$("div.week-status").css("height","60px").hide();$("div.week-status-btn").attr("rel","");console.log(" > viewWeek("+d+")");var c=(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));if(!c&&window.outerWidth>479){if(currentWeek!=d){$("#weekViewArrow").slideDown(200);$("div.week"+d).fadeIn(1000);if(parseInt(d)<=(timeline.getCurrentWeek())){$("div.week"+d).animate({height:"340px"})}else{$("div.week"+d).animate({height:"110px"})}var b=(parseInt(d)*9.72)+parseInt(d)+"%";$("#weekViewArrow").animate({left:b});$("#weekViewActions").fadeIn();$("#weekViewActions2").fadeIn();currentWeek=d}else{$("div.week"+d).animate({height:"60px"});currentWeek="";$("#weekViewArrow").hide();$("#weekViewActions").fadeOut();$("#weekViewActions2").fadeOut();$("div."+d).hide()}}else{showWeekActivites(d)}}function showWeekActivites(b){$("#WeekActivitiesTitle").html("Activities for Week "+b);$(".viewWeeksOverlayDisplay").hide();$("#dailyActivitiesWeek"+b).show();$("#week-day-view").modal("show")};